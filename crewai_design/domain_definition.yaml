# ============================================================================
# DEFINICI√ìN DE DOMINIO: Sistema de An√°lisis de Contratos de Pr√©stamo
# ============================================================================
# Versi√≥n: 1.0
# Fecha: 2025-12-01
# Basado en: Metodolog√≠a de 8 Fases para CrewAI Anti-Alucinaci√≥n

domain:
  name: "An√°lisis Automatizado de Contratos de Pr√©stamo"

  description: >
    Sistema multi-agente que analiza contratos de pr√©stamo en PDF, extrayendo
    informaci√≥n financiera clave, calculando m√©tricas avanzadas (CAT, TEA, TIR),
    evaluando riesgos, y generando reportes profesionales con recomendaciones
    estrat√©gicas (Aceptar/Negociar/Rechazar).

  # ============================================================================
  # ‚úÖ CAPACIDADES DEL SISTEMA
  # ============================================================================

  capabilities:
    extraction:
      - "Extraer partes del contrato (prestamista, prestatario) con confianza >90%"
      - "Identificar monto principal y moneda (USD, EUR, MXN)"
      - "Detectar tipo de tasa (fija/variable) y extraer tasa nominal"
      - "Extraer plazo en meses y frecuencia de pago (mensual/trimestral/semestral/anual/bullet)"
      - "Identificar garant√≠as (reales/personales/mixtas) con descripci√≥n"
      - "Extraer comisiones (apertura, mantenimiento, seguros) con valores"
      - "Detectar cl√°usulas de prepago con penalizaciones"
      - "Identificar covenants financieros (DSCR, Deuda/EBITDA, Negative Pledge)"
      - "Detectar cl√°usulas de incumplimiento y cross-default"
      - "Manejar contratos multi-tramo (hasta 5 tramos)"
      - "Identificar periodo de gracia y estructura bullet"
      - "Extraer cap y floor para tasas variables"

    financial_calculation:
      - "Generar tabla de amortizaci√≥n completa (m√©todo franc√©s, bullet, con gracia)"
      - "Calcular CAT (Costo Anual Total) considerando todos los costos"
      - "Calcular TEA (Tasa Efectiva Anual)"
      - "Calcular TIR (Tasa Interna de Retorno)"
      - "Calcular VPN (Valor Presente Neto) del costo de financiamiento"
      - "Comparar con tasas de mercado por tipo de empresa, plazo y sector"
      - "Generar an√°lisis de sensibilidad para tasas variables (escenarios ¬±1%, ¬±2%)"
      - "Calcular impacto de escenarios de prepago"

    risk_assessment:
      - "Evaluar riesgo en 5 categor√≠as (Liquidez, Tasa, Operativo, Legal, Prepago)"
      - "Asignar score 0-100 ponderado por categor√≠a"
      - "Identificar red flags (tasa elevada, triggers excesivos, sin cap, etc.)"
      - "Clasificar nivel de riesgo (Muy Bajo/Bajo/Moderado/Alto/Muy Alto)"
      - "Generar lista de fortalezas del contrato"
      - "Generar lista de debilidades y puntos de negociaci√≥n"
      - "Proporcionar recomendaci√≥n estrat√©gica (Aceptar/Negociar/Rechazar)"

    report_generation:
      - "Generar resumen ejecutivo contextualizado"
      - "Crear visualizaciones (amortizaci√≥n, distribuci√≥n costos, radar riesgos)"
      - "Producir reporte PDF profesional con narrativas din√°micas"
      - "Exportar datos a Excel con hojas separadas (Resumen, Amortizaci√≥n)"

  # ============================================================================
  # ‚ùå LIMITACIONES EXPL√çCITAS
  # ============================================================================

  limitations:
    technical:
      - "No puede leer contratos en formatos no-PDF (Word, im√°genes escaneadas sin OCR)"
      - "No puede extraer datos de tablas complejas con formato irregular"
      - "No puede interpretar cl√°usulas escritas en lenguaje excesivamente legal/ambiguo"
      - "No tiene acceso a bases de datos externas de tasas en tiempo real"
      - "No puede validar identidad legal de prestamistas/prestatarios"

    functional:
      - "No puede tomar decisiones finales - solo proporciona recomendaciones"
      - "No debe aprobar/rechazar contratos sin revisi√≥n humana final"
      - "No puede predecir cambios futuros en √≠ndices de referencia (TIIE, EURIBOR)"
      - "No debe hacer proyecciones de flujo de caja del prestatario"
      - "No puede evaluar capacidad de pago del prestatario (requiere datos externos)"

    legal_compliance:
      - "No constituye asesor√≠a legal - requiere validaci√≥n por abogado"
      - "No verifica cumplimiento regulatorio espec√≠fico por jurisdicci√≥n"
      - "No sustituye due diligence legal completa"
      - "No debe usarse como √∫nica fuente para decisiones de cr√©dito >$1M USD"

  # ============================================================================
  # üìä M√âTRICAS DE √âXITO
  # ============================================================================

  success_metrics:
    # Precisi√≥n de extracci√≥n
    extraction_accuracy_target: 0.95
    extraction_accuracy_description: "95% de campos cr√≠ticos extra√≠dos correctamente"

    # Control de alucinaciones
    hallucination_threshold: 0.05
    hallucination_description: "M√°ximo 5% de datos inventados o inferidos incorrectamente"

    # Completitud
    task_completion_target: 0.90
    task_completion_description: "90% de contratos procesados completamente sin errores"

    # Consistencia
    consistency_target: 0.85
    consistency_description: "85% de overlap en datos extra√≠dos al procesar mismo contrato 2 veces"

    # Calidad de c√°lculos
    calculation_accuracy_target: 0.99
    calculation_accuracy_description: "99% de c√°lculos financieros correctos (¬±0.1% de margen)"

    # Utilidad de recomendaciones
    recommendation_usefulness_target: 0.80
    recommendation_description: "80% de recomendaciones consideradas √∫tiles por expertos"

  # ============================================================================
  # üö® CRITERIOS DE FALLO CR√çTICO
  # ============================================================================

  critical_failures:
    extraction_critical:
      - "Inventar monto principal cuando no est√° en el contrato"
      - "Reportar tasa de inter√©s sin fuente textual verificable"
      - "Fabricar ArXiv IDs, n√∫meros de contrato, o identificadores"
      - "Asignar valores por defecto a campos cr√≠ticos sin marcarlos como 'asumidos'"

    calculation_critical:
      - "Generar tabla de amortizaci√≥n con errores matem√°ticos >1%"
      - "Reportar CAT/TEA con desviaci√≥n >0.5% del valor correcto"
      - "Omitir comisiones o costos en el c√°lculo del CAT"

    risk_critical:
      - "Omitir red flags cr√≠ticos (ej: tasa variable sin cap)"
      - "Recomendar 'Aceptar' cuando score total <40/100"
      - "Clasificar riesgo 'Bajo' cuando hay 3+ red flags de severidad alta"

    report_critical:
      - "Incluir afirmaciones sin evidencia del contrato"
      - "Usar lenguaje especulativo ('probablemente', 'podr√≠a ser', 'tal vez')"
      - "Generar narrativas contradictorias entre secciones del reporte"

  # ============================================================================
  # üéØ CAMPOS CR√çTICOS OBLIGATORIOS
  # ============================================================================

  critical_fields:
    tier_1_absolutely_required:
      - monto_principal
      - moneda
      - tasa_nominal
      - tipo_tasa
      - plazo_meses

    tier_2_highly_important:
      - frecuencia_pago
      - prestamista
      - prestatario
      - garantias
      - comisiones

    tier_3_important:
      - prepago
      - covenants
      - periodo_gracia
      - es_bullet

  # ============================================================================
  # üìè FORMATOS EST√ÅNDAR DE DATOS
  # ============================================================================

  data_formats:
    montos:
      format: "N√∫mero decimal sin s√≠mbolos ni separadores de miles"
      examples_valid:
        - "1000000.00"
        - "50000.50"
        - "250000"
      examples_invalid:
        - "$1,000,000"
        - "1.000.000,00"
        - "un mill√≥n de d√≥lares"

    tasas_interes:
      format: "Porcentaje decimal con hasta 2 decimales"
      examples_valid:
        - "8.50"
        - "12.75"
        - "3.25"
      examples_invalid:
        - "0.085"
        - "8.5%"
        - "ocho punto cinco por ciento"

    fechas:
      format: "ISO 8601 (YYYY-MM-DD)"
      examples_valid:
        - "2025-12-01"
        - "2026-06-15"
      examples_invalid:
        - "01/12/2025"
        - "12-01-2025"
        - "1 de diciembre de 2025"

    monedas:
      format: "C√≥digo ISO 4217 de 3 letras"
      examples_valid:
        - "USD"
        - "EUR"
        - "MXN"
      examples_invalid:
        - "d√≥lares"
        - "$"
        - "euros"

    plazos:
      format: "N√∫mero entero de meses"
      examples_valid:
        - "12"
        - "36"
        - "60"
      examples_invalid:
        - "12 meses"
        - "3 a√±os"
        - "treinta y seis"

  # ============================================================================
  # üîÑ FLUJO DE PROCESAMIENTO
  # ============================================================================

  processing_flow:
    step_1:
      name: "Extracci√≥n de Datos"
      agent: "contract_data_extractor"
      input: "PDF del contrato + texto extra√≠do"
      output: "JSON estructurado con datos extra√≠dos + nivel de confianza"
      validation: "Quality inspector verifica precisi√≥n y detecta alucinaciones"

    step_2:
      name: "C√°lculos Financieros"
      agent: "financial_calculator"
      input: "JSON de datos extra√≠dos del paso 1"
      output: "JSON con tabla de amortizaci√≥n, CAT, TEA, TIR, VPN, comparaci√≥n mercado"
      validation: "Verificar c√°lculos matem√°ticos con tolerancia ¬±0.1%"

    step_3:
      name: "Evaluaci√≥n de Riesgos"
      agent: "risk_evaluator"
      input: "JSON de datos extra√≠dos + JSON de c√°lculos financieros"
      output: "JSON con scores por categor√≠a, red flags, recomendaci√≥n estrat√©gica"
      validation: "Verificar consistencia entre scores y recomendaci√≥n"

    step_4:
      name: "S√≠ntesis de Reporte"
      agent: "report_synthesizer"
      input: "Outputs de los 3 agentes anteriores"
      output: "Reporte markdown estructurado + JSON para visualizaciones"
      validation: "Verificar coherencia narrativa y ausencia de contradicciones"

  # ============================================================================
  # üß™ ESTRATEGIA DE TESTING
  # ============================================================================

  testing_strategy:
    test_contracts:
      basic_cases:
        - "Contrato simple: tasa fija, amortizaci√≥n francesa, sin comisiones"
        - "Contrato est√°ndar: tasa fija, comisiones est√°ndar, garant√≠a hipotecaria"
        - "Contrato multi-tramo: 2 tramos con tasas diferentes"

      adversarial_cases:
        - "Contrato con tasa variable sin cap (debe generar red flag)"
        - "Contrato con datos faltantes (debe marcar como 'No encontrado')"
        - "Contrato bullet con periodo de gracia (estructura compleja)"
        - "Contrato con m√∫ltiples covenants y cross-default"
        - "PDF con formato irregular o texto mal estructurado"

      edge_cases:
        - "Monto en notaci√≥n cient√≠fica o con palabras"
        - "Tasas expresadas de m√∫ltiples formas en el mismo contrato"
        - "Fechas en formatos no est√°ndar"
        - "Garant√≠as descritas de forma ambigua"

    validation_protocol:
      manual_review:
        - "Revisar 100% de extracciones en primeros 10 contratos"
        - "Validar c√°lculos contra hoja Excel manual"
        - "Verificar recomendaciones con analista financiero senior"

      automated_checks:
        - "Validar formato JSON contra schema"
        - "Verificar suma de componentes en tabla de amortizaci√≥n"
        - "Confirmar consistencia entre scores y nivel de riesgo"

  # ============================================================================
  # üìà CRITERIOS DE PRODUCCI√ìN
  # ============================================================================

  production_readiness:
    requirements:
      - "Pass rate >90% en test suite completo (basic + adversarial + edge)"
      - "Hallucination rate <5% verificado en 20+ contratos reales"
      - "Calculation accuracy >99% validado contra Excel"
      - "0 critical failures en √∫ltimos 50 contratos procesados"
      - "Validaci√≥n por 2+ analistas financieros seniors"

    monitoring:
      - "Auditor√≠a manual de 10% de contratos procesados"
      - "Reporte mensual de m√©tricas de precisi√≥n"
      - "Review trimestral de casos fallidos"

# ============================================================================
# FIN DE DEFINICI√ìN DE DOMINIO
# ============================================================================
